 @{var makaleYorumList = ViewBag.MakaleYorum as List<Yorumlar>; } 


<h6>Makaleler > @ViewBag.Makale.Baslik</h6>
<div class="container">
    <div class="row">
        <div class="col-md-4">
            @await Component.InvokeAsync("MakaleList")
            @* <ul class="list-group">
            <li class="list-group-item active" aria-current="true">Yayımlanan Makaleler</li>
            @foreach (var item in Model)
            {
            <li class="list-group-item">
            <a asp-action="MakalelerDetay" asp-controller="Home" asp-route-id="@item.Id">@item.Baslik</a>
            </li>
            }
            </ul> *@
        </div>
        <div class="col-md-8" style="text-align:justify">

            <h4>@ViewBag.Makale.Baslik</h4>
            <p>@ViewBag.Makale.Icerik</p>
            <div>
                <i class="fas fa-thumbs-up" id="like-icon"></i>
                <span id="like-count">@ViewBag.Makale.LikeCount</span>

                <i class="fas fa-thumbs-down" id="dislike-icon"></i>
                <span id="dislike-count">@ViewBag.Makale.DislikeCount</span>
            </div>

            <hr />
           @*  <div id="yorumlar" class="col-md-12">

            </div> *@
 
            <div class="row">
                <div class="col-md-12 my-3"><h4>Yorumlar</h4></div>
                @foreach (var yorum in makaleYorumList)
                {
                    if (yorum.ParentId==null)
                    {
                        <div class="col-md-12">
                            <strong>@yorum.Email</strong> - @yorum.Tarih.ToString("dd.MM.yyyy")
                            <p>@yorum.Icerik</p>
                        </div>
                        @foreach (var yanit in yorum.InverseParent)
                        {
                            <div class="col-md-12" style="margin-left:20px">
                                <strong>@yanit.Email</strong> - @yanit.Tarih.ToString("dd.MM.yyyy")
                                <p>@yanit.Icerik</p>
                            </div>
                        }                       
                    }
                    
                }  
                
                    <form id="myForm" style="margin-left: 20px;">
                        <input type="hidden" name="MakaleId" value="@ViewBag.Makale.Id" />
                        <input type="text" name="ParentId" value=10 /><br />                        
                        <input type="text" id="Email" name="Email" placeholder="Email" style="width:200px" /><br />
                        <textarea type="text" id="Icerik" name="Icerik" placeholder="Yorum" style="width:200px"></textarea><br />
                        <button type="button" id="btnYorumKaydet">Yorum Gönder</button><br />
                    </form>
                
               
            </div>

        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {
            $('#like-icon').click(function () {

                $.ajax({
                    url: '@Url.Action("Like", "Home", new { id = ViewBag.Makale.Id })',
                    type: 'POST',
                    dataType: 'json',

                    success: function (data) {
                        $('#like-count').text(data);
                    }
                });
            });

            $('#dislike-icon').click(function () {
                $.ajax({
                    url: '@Url.Action("Dislike", "Home", new { id = ViewBag.Makale.Id })',
                    type: 'POST',
                    dataType: 'json',

                    success: function (data) {
                        $('#dislike-count').text(data);
                    }
                });
            });

         

            $("#btnYorumKaydet").click(function () {
                var formData = {
                    MakaleId: $('#MakaleId').val(),
                    ParentId: $('#ParentId').val(),
                    Email: $('#Email').val(),                    
                    Icerik: $('#Icerik').val(),
                }
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("YorumYap", "Home")',
                    dataType: 'json',
                    data: { formData: formData },
                    success: function (response) {
                        console.log(response);                       
                    },
                    error: function (e) {
                        console.log(e);
                    },
                });
            });

        });

    </script>
}





@* @section Scripts{
    <script type="text/javascript">
        $(document).ready(function () { 
           
        });
    </script>
} *@